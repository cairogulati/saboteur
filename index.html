<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>‚õèÔ∏è Saboteur Leaderboard</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=MedievalSharp&family=Poppins:wght@400;600;700&display=swap');

:root{
  --bg1:#1b1b1b; --bg2:#2f2f2f; --bg3:#4e342e; --bg4:#000;
  --text:#f5deb3; --glass:rgba(20,20,20,0.65);
  --gold:#ffd700; --silver:#c0c0c0; --bronze:#cd7f32;
}

body{
  margin:0;
  font-family:'Poppins',sans-serif;
  color:var(--text);
  background:linear-gradient(-45deg,var(--bg1),var(--bg2),var(--bg3),var(--bg4));
  background-size:400% 400%;
  animation:gradientShift 20s ease infinite;
}

@keyframes gradientShift{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

h1{
  text-align:center;
  margin:40px 0 10px;
  font-family:'MedievalSharp',cursive;
  font-size:3rem;
}

/* üåô Dark mode button */
#themeBtn{
  position:fixed;
  top:20px;
  right:20px;
  z-index:5;
}

/* ü™ô Gold rain */
#gold-rain{
  position:fixed;
  width:100%;height:100%;
  pointer-events:none;
  overflow:hidden;
  z-index:0;
}
.coin{
  position:absolute;
  top:-40px;
  animation:fall linear infinite;
}
@keyframes fall{to{transform:translateY(110vh) rotate(360deg);}}

.leaderboard{
  width:92%;
  max-width:950px;
  margin:auto;
  background:var(--glass);
  border-radius:22px;
  backdrop-filter:blur(14px);
  overflow:hidden;
  box-shadow:0 0 25px rgba(255,140,0,0.2);
  position:relative;
  z-index:2;
}

table{width:100%;border-collapse:collapse;}
th,td{padding:16px;text-align:center;}
thead{background:rgba(255,255,255,0.1);}
.rank-1 td{color:var(--gold);font-weight:700}
.rank-2 td{color:var(--silver)}
.rank-3 td{color:var(--bronze)}

.score-cell{position:relative;cursor:help;}
.tooltip{
  position:absolute;
  bottom:120%;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.9);
  padding:10px;
  border-radius:10px;
  font-size:0.8rem;
  white-space:pre-line;
  width:260px;
  display:none;
  z-index:10;
}
.tooltip.below{top:120%;bottom:auto;}
.score-cell:hover .tooltip{display:block;}

#statsPanel{
  max-width:950px;
  margin:25px auto;
  padding:15px 25px;
  background:rgba(0,0,0,0.4);
  border-radius:16px;
  font-size:0.9rem;
  line-height:1.6;
  z-index:2;
  position:relative;
}
</style>
</head>

<body>

<div id="gold-rain"></div>
<button id="themeBtn">üåô</button>

<h1>‚õèÔ∏è Saboteur Leaderboard</h1>

<div class="leaderboard">
<table>
<thead><tr><th>Rank</th><th>Player</th><th>Score</th></tr></thead>
<tbody id="tbody"></tbody>
</table>
</div>

<div id="statsPanel"></div>

<script>
const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vS3I0a4JhGI4fPs82EWRpcWMiDrQ1dqeDlzC5xQ3KP9hQTCneU1d4EBpvmrFGibztVx3mtdm7k7juq0/pub?output=csv";

function createCoin(){
  const coin=document.createElement("div");
  coin.className="coin";
  coin.textContent="ü™ô";
  coin.style.left=Math.random()*100+"vw";
  coin.style.fontSize=(14+Math.random()*18)+"px";
  coin.style.opacity=0.08+Math.random()*0.15;
  coin.style.animationDuration=(6+Math.random()*6)+"s";
  document.getElementById("gold-rain").appendChild(coin);
  setTimeout(()=>coin.remove(),12000);
}
setInterval(createCoin,500);

function getTitle(minerWins,sabWins){
  const total=minerWins+sabWins;
  if(total===0) return "";
  if(sabWins/total>0.6) return "üòà Shadow Master";
  if(minerWins/total>0.6) return "‚õèÔ∏è Gold Guardian";
  return "üé≠ Double Agent";
}

async function load(){
  const res=await fetch(CSV_URL+"&t="+Date.now());
  const txt=await res.text();
  const lines=txt.trim().split("\n");
  const h=lines[0].split(",");
  const i=k=>h.indexOf(k);
  const num=v=>Number(v)||0;

  const rows=lines.slice(1).map(r=>{
    const c=r.split(",");
    return {game:c[i("game_id")],name:c[i("name")],r1:num(c[i("r1")]),r2:num(c[i("r2")]),r3:num(c[i("r3")]),gold:num(c[i("gold")]),total:num(c[i("total")])};
  });

  const byPlayer={};
  rows.forEach(r=>{
    byPlayer[r.name]??={games:[],miner:0,sab:0};
    byPlayer[r.name].games.push(r);
    [r.r1,r.r2,r.r3].forEach(s=>{
      if(s===3) byPlayer[r.name].miner++;
      if(s===4) byPlayer[r.name].sab++;
    });
  });

  const players=Object.entries(byPlayer).map(([name,data])=>{
    data.games.sort((a,b)=>b.total-a.total);
    const top=data.games.slice(0,3);
    return{name,top,score:top.reduce((s,g)=>s+g.total,0),miner:data.miner,sab:data.sab,title:getTitle(data.miner,data.sab)};
  }).sort((a,b)=>b.score-a.score);

  const tbody=document.getElementById("tbody");
  tbody.innerHTML="";

  players.forEach((p,i)=>{
    const totalWins=p.miner+p.sab;
    const betrayal=totalWins?Math.round((p.sab/totalWins)*100):0;
    const flavor=p.sab>p.miner?"‚ö†Ô∏è Trust issues follow this player.":"ü§ù Usually builds, sometimes betrays.";

    const breakdown=p.top.map(g=>`Game ${g.game}\nR1:${g.r1} R2:${g.r2} R3:${g.r3}\nGold:${g.gold}\nTotal:${g.total}`).join("\n\n");

    const tr=document.createElement("tr");
    tr.className=`rank-${i+1}`;
    tr.innerHTML=`
      <td>${i+1}</td>
      <td title="${flavor}">${p.name} ${p.title}</td>
      <td class="score-cell">${p.score}
        <div class="tooltip">${breakdown}

Role Record:
‚õèÔ∏è Miner Wins: ${p.miner}
üòà Saboteur Wins: ${p.sab}
üí£ Betrayal Rating: ${betrayal}%</div>
      </td>`;
    tbody.appendChild(tr);

    setTimeout(()=>{
      const cell=tr.querySelector(".score-cell");
      if(cell.getBoundingClientRect().top<200)
        cell.querySelector(".tooltip").classList.add("below");
    },0);
  });

  const topSab=players.reduce((a,b)=>b.sab>a.sab?b:a);
  const topMiner=players.reduce((a,b)=>b.miner>a.miner?b:a);

  document.getElementById("statsPanel").innerHTML=`
üòà Most Successful Saboteur: <b>${topSab.name}</b> (${topSab.sab} wins)<br>
‚õèÔ∏è Best Team Player: <b>${topMiner.name}</b> (${topMiner.miner} miner wins)
`;

}

document.getElementById("themeBtn").onclick=()=>document.body.classList.toggle("dark-mode");

load();
setInterval(load,30000);
</script>
</body>
</html>

